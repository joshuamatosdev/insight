# Test configuration - uses dev PostgreSQL server
# No Testcontainers required - connects to localhost:5433

spring:
  application:
    name: sam-gov-ingestor-test

  # Disable Redis and Elasticsearch autoconfiguration for tests
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisHealthContributorAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.data.redis.RedisReactiveHealthContributorAutoConfiguration
      - org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration
      - org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration
      - org.springframework.boot.actuate.autoconfigure.elasticsearch.ElasticsearchReactiveHealthContributorAutoConfiguration

  # Use dev PostgreSQL server
  datasource:
    url: jdbc:postgresql://localhost:5433/sam_test
    username: dev_user
    password: dev_pass
    driver-class-name: org.postgresql.Driver

  # JPA/Hibernate configuration for tests
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # Disable virtual threads in tests for predictable behavior
  threads:
    virtual:
      enabled: false

  # Elasticsearch disabled for tests (no running ES instance required)
  # Enable this if you have Elasticsearch running locally
  elasticsearch:
    uris: ${ELASTICSEARCH_URI:http://localhost:9200}

  # Disable Elasticsearch repository scanning for tests
  data:
    elasticsearch:
      repositories:
        enabled: false

# Disable Elasticsearch for tests
elasticsearch:
  enabled: false

  # Do NOT configure Redis - use ConcurrentMapCacheManager fallback instead
  # (Redis is only enabled when spring.data.redis.host is set)
  cache:
    type: simple

# Disable scheduled tasks during tests
sam:
  gov:
    api-key: test-api-key
    base-url: https://api.sam.gov/opportunities/v2/search
    naics-codes:
      - "541511"
    limit: 10
    posted-within-days: 7
    ptype: "k,o"
    set-aside: ""
    rate-limit-ms: 0
    sbir-enabled: false
    sbir-keywords: []

sbir:
  gov:
    enabled: false
    base-url: https://api.www.sbir.gov/public/api
    agencies: []
    rows-per-request: 10
    max-results: 100
    rate-limit-ms: 0
    it-keywords: []

# Actuator configuration for tests
management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: never

# JWT Configuration for tests
# Base64-encoded 256-bit (32-byte) secret for HS256
jwt:
  secret: dGVzdC1qd3Qtc2VjcmV0LWtleS10aGF0LWlzLWF0LWxlYXN0LTMyLWNoYXJzLWxvbmctZm9yLXRlc3Rpbmc=
  expiration: 3600000
  refresh-expiration: 86400000

# Application Configuration for tests
app:
  name: SAM.gov Test
  base-url: http://localhost:8080
  email:
    provider: console
  password-reset:
    expiration-hours: 1
  invitation:
    expiration-days: 1
  session:
    max-per-user: 5

# Disable rate limiting for tests (set very high limit)
rate:
  limit:
    requests-per-minute: 100000
    window-seconds: 1
    cleanup-interval-seconds: 3600

# AWS S3 Configuration for tests (mocked)
# Set enabled to false to use mock beans from TestS3Config
aws:
  s3:
    enabled: false
    bucket: test-bucket
    region: us-east-1
    endpoint: ""
    presigned-url-expiration-minutes: 15
  credentials:
    access-key: test-access-key
    secret-key: test-secret-key

# Reduce logging noise in tests
logging:
  level:
    root: WARN
    com.samgov.ingestor: INFO
    org.hibernate.SQL: WARN
    org.springframework.test: WARN
