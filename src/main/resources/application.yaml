spring:
  config:
    import: optional:file:.env[.properties]

  application:
    name: insight-platform
    
  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5433}/${POSTGRES_DB:sam_opportunities}
    username: ${POSTGRES_USER:dev_user}
    password: ${POSTGRES_PASSWORD:dev_pass}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    # Disable Open Session In View - anti-pattern that keeps connections open during rendering
    open-in-view: false
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        # Batch insert optimization - dramatically improves bulk save performance
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true

  threads:
    virtual:
      enabled: true

  # ============================================
  # Elasticsearch Configuration
  # ============================================
  elasticsearch:
    uris: ${ELASTICSEARCH_URI:http://localhost:9200}

  # ============================================
  # Redis Configuration for Distributed Caching
  # ============================================
  data:
    redis:
      host: ${REDIS_HOST:}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms

  # Cache Configuration
  cache:
    type: ${CACHE_TYPE:simple}  # 'redis' for production, 'simple' for local dev
    redis:
      time-to-live: 3600000  # 1 hour default TTL in milliseconds
      cache-null-values: false

sam:
  gov:
    api-key: ${SAM_API_KEY}
    base-url: https://api.sam.gov/opportunities/v2/search
    
    # ============================================
    # NAICS CODES - Organized by Category
    # ============================================
    naics-codes:
      # --- Core Software + IT Delivery (must-have) ---
      - "541511"  # Custom Computer Programming Services
      - "541512"  # Computer Systems Design Services (integration/design/implementation)
      - "541513"  # Computer Facilities Management Services (on-site ops/management)
      - "541519"  # Other Computer Related Services (catch-all IT services)
      
      # --- Cloud / Hosting / Platforms ---
      - "518210"  # Computing Infrastructure, Data Processing, Web Hosting
      
      # --- SaaS Product (if selling product, not just services) ---
      - "513210"  # Software Publishers
      
      # --- Cyber / Resilience / IR-Adjacent ---
      # (541519 and 541512 already listed above)
      
      # --- Data / Analytics / Decision Intelligence ---
      - "541611"  # Administrative & General Management Consulting
      - "541618"  # Other Management Consulting Services
      - "541690"  # Other Scientific and Technical Consulting
      
      # --- Engineering / Mission Engineering-Adjacent ---
      - "541330"  # Engineering Services
      
      # --- R&D (prototypes, applied research, pilots) ---
      - "541715"  # R&D Physical/Engineering/Life Sciences (except Nano/Biotech)
      - "541713"  # R&D in Nanotechnology (DoD-style R&D buys)
      - "541714"  # R&D in Biotechnology (health/biomed if applicable)
      - "541720"  # R&D Social Sciences/Humanities (human-systems/policy analytics)
      
      # --- Training / Enablement ---
      - "611420"  # Computer Training
      - "611430"  # Professional and Management Development Training
      
      # --- GIS / Mapping-Adjacent (city/county geo + dashboard) ---
      - "541360"  # Geophysical Surveying and Mapping Services
      - "541370"  # Surveying and Mapping (except Geophysical)
      
      # --- Catch-All Professional Services ---
      - "541990"  # All Other Professional, Scientific, and Technical Services
    # Search parameters
    limit: 1000
    posted-within-days: 30
    # Procurement types: o=Original, k=Combined Synopsis/Solicitation, p=Presolicitation, r=Sources Sought
    ptype: "k,o"
    # Set-aside filters (optional, comma-separated)
    # SBA, 8A, HUBZone, SDVOSB, WOSB, EDWOSB, etc.
    set-aside: ""
    # Rate limiting (ms between API calls)
    rate-limit-ms: 500
    
    # ============================================
    # SBIR/STTR Configuration (SAM.gov keyword search)
    # ============================================
    sbir-enabled: true
    sbir-keywords:
      - "SBIR"
      - "STTR"
      - "Small Business Innovation Research"
      - "Small Business Technology Transfer"

# ============================================
# SBIR.gov API Configuration
# https://www.sbir.gov/api
# ============================================
sbir:
  gov:
    enabled: true
    base-url: https://api.www.sbir.gov/public/api
    # Agencies to fetch awards from
    # Valid: DOD, HHS, NASA, NSF, DOE, USDA, EPA, DOC, ED, DOT, DHS
    agencies:
      - DOD
      - NASA
      - NSF
      - DOE
      - HHS
    rows-per-request: 100
    max-results: 2000
    rate-limit-ms: 500
    # Keywords to filter IT-related awards
    it-keywords:
      - software
      - cybersecurity
      - cloud
      - AI
      - artificial intelligence
      - machine learning
      - data analytics
      - IT
      - information technology
      - computer
      - programming
      - SaaS
      - automation
      - digital transformation
      - API
      - microservices
      - DevOps
      - platform

# Actuator endpoints for health checks and monitoring
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5, 0.75, 0.95, 0.99
    tags:
      application: ${spring.application.name}
      environment: ${ENVIRONMENT:development}
  info:
    env:
      enabled: true

# Application info
info:
  app:
    name: Insight Contract Intelligence Platform
    description: Multi-source government and commercial contract intelligence
    version: 1.0.0

# JWT Configuration
# SECURITY: JWT_SECRET must be set in environment/secrets for production
# Generate with: openssl rand -base64 32
jwt:
  secret: ${JWT_SECRET}  # Required - no default for security
  expiration: 86400000  # 24 hours in milliseconds
  refresh-expiration: 604800000  # 7 days in milliseconds

# Application Configuration
app:
  name: ${APP_NAME:Insight Contract Intelligence}
  base-url: ${APP_BASE_URL:http://localhost:3000}
  production-url: ${APP_PRODUCTION_URL:https://insight.doctrineone.us}
  api-url: ${APP_API_URL:http://localhost:8080}
  docs-url: ${APP_DOCS_URL:https://docs.insight.doctrineone.us}
  support-email: ${APP_SUPPORT_EMAIL:support@doctrineone.us}
  email:
    provider: ${EMAIL_PROVIDER:console}  # console, smtp, sendgrid, ses
  password-reset:
    expiration-hours: 24
  invitation:
    expiration-days: 7
  session:
    max-per-user: 10

# AWS S3 Configuration for File Storage
# SECURITY: AWS credentials must be set via environment variables in production
# For local development, use LocalStack with AWS_S3_ENDPOINT override
aws:
  s3:
    bucket: ${AWS_S3_BUCKET:insight-files}
    region: ${AWS_REGION:us-east-1}
    endpoint: ${AWS_S3_ENDPOINT:}  # Set to LocalStack URL for local development
    presigned-url-expiration-minutes: ${AWS_S3_PRESIGNED_EXPIRATION:15}
  credentials:
    access-key: ${AWS_ACCESS_KEY_ID:}
    secret-key: ${AWS_SECRET_ACCESS_KEY:}

# Stripe Configuration for Billing
# SECURITY: All Stripe keys must be set via environment variables in production
stripe:
  secret-key: ${STRIPE_SECRET_KEY:}
  webhook-secret: ${STRIPE_WEBHOOK_SECRET:}
  publishable-key: ${STRIPE_PUBLISHABLE_KEY:}
  prices:
    starter: ${STRIPE_PRICE_STARTER:}
    professional: ${STRIPE_PRICE_PROFESSIONAL:}
    enterprise: ${STRIPE_PRICE_ENTERPRISE:}

# Spring AI / OpenAI Configuration
# SECURITY: OPENAI_API_KEY must be set via environment variables
spring.ai:
  openai:
    api-key: ${OPENAI_API_KEY:}
    enabled: ${OPENAI_ENABLED:true}
    chat:
      options:
        model: ${OPENAI_MODEL:gpt-4o}
        temperature: 0.3
        max-tokens: 2000

# Logging
logging:
  level:
    com.samgov.ingestor: INFO
    org.hibernate.SQL: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"